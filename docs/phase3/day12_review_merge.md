# Day 12: レビューとマージ — PRにコメントし、修正し、統合する

## 学習目標

- PRにレビューコメントをつける方法を覚える
- レビュー指摘を受けて修正し、再プッシュする流れを体験する
- Approve（承認）してからマージする手順を理解する
- `git pull` でmainを最新状態に保つ習慣を身につける

## 題材

`team_docs/team_rules.md` にチームルールを追記するPRを作成し、レビュー → 修正 → Approve → Merge の一連の流れを体験する。

## ファイル構成

```
team_docs/
├── members/          ← Day 11 で作成済み
│   ├── itoh.md
│   ├── kurihara.md
│   └── saruwatari.md
└── team_rules.md     ← 今日の題材（講師が事前にベースを作成）
```

### team_rules.md のベース内容

講師が事前に以下の内容で `team_rules.md` を作成しておく。

```markdown
# チームルール

## コミュニケーション

- (ここにルールを追記していく)

## Git運用

- (ここにルールを追記していく)

## その他

- (ここにルールを追記していく)
```

---

## 準備

### 1. mainを最新状態にする

```bash
git checkout main
git pull
```

> **Day 12 からの新習慣**: 作業を始める前に必ず `git pull` する。チームメンバーの変更が反映されている可能性がある。

### 2. team_rules.md が存在することを確認

```bash
cat team_docs/team_rules.md
```

---

## 手順

Day 12 は **3人が順番に** 以下の流れを行う。全員がレビュアーとレビュイーの両方を体験する。

### 役割分担

| 順番 | PRを出す人（レビュイー） | レビューする人（レビュアー） |
|-----|----------------------|--------------------------|
| 1番目 | 伊藤 | 栗原・猿渡 |
| 2番目 | 栗原 | 猿渡・伊藤 |
| 3番目 | 猿渡 | 伊藤・栗原 |

---

### ステップ 1: mainを最新にしてブランチを作成する

```bash
# 最新のmainを取得（前の人のマージが反映される）
git checkout main
git pull

# ブランチを作成
# 例: 伊藤さんの場合
git checkout -b feature/add-rule-itoh
```

### ステップ 2: チームルールを追記する

`team_docs/team_rules.md` を開き、**自分が提案するルール** を1つ追記する。

**伊藤の例**:
```markdown
## コミュニケーション

- 質問はSlackの #team チャンネルに投稿する（伊藤）
```

**栗原の例**:
```markdown
## Git運用

- コミットメッセージは日本語で書く（栗原）
```

**猿渡の例**:
```markdown
## その他

- 毎朝10時に進捗を共有する（猿渡）
```

> 追記する場所は、各セクションの `- (ここにルールを追記していく)` の下に追加する。

### ステップ 3: コミットしてプッシュする

```bash
git add team_docs/team_rules.md
git commit -m "feat: チームルールにコミュニケーションルールを追加"
git push -u origin feature/add-rule-itoh
```

### ステップ 4: PRを作成する

GitHub上でPRを作成する。

```
タイトル: feat: チームルールに[セクション名]を追加

本文:
## 変更内容
- team_rules.md の [セクション名] に新しいルールを追加

## 追加したルール
- [追加したルールの内容]

## レビューお願いします
@[レビュアーの名前] @[レビュアーの名前]
確認ポイント:
- [ ] ルールの内容は妥当か
- [ ] 書き方のフォーマットは正しいか
```

### ステップ 5: レビューする（レビュアー側）

レビュアーは、PRの「Files changed」タブを開いて確認する。

**レビューコメントの付け方**:

1. 「Files changed」タブを開く
2. コメントしたい行の **左側の `+` マーク** をクリック
3. コメントを入力する（例: 「いいルールですね！」「ここの書き方を変えませんか？」）
4. 「Start a review」をクリック（1つ目のコメント時）
5. 他にもコメントがあれば同様に追加
6. 右上の「Review changes」をクリック
7. コメント欄に全体の感想を書く
8. 「Request changes」を選択して「Submit review」をクリック

> **Request changes** = 「修正してほしい点がある」という意味。修正なしでOKなら **Approve** を選ぶ。

**レビューコメントの例**（練習用）:

必ず1つ以上の修正リクエストを出す（練習のため）。

- 「ルールの末尾に句点（。）をつけてください」
- 「『投稿する』を『投稿すること』に変えてみては？」
- 「理由も一緒に書くとわかりやすいと思います」

### ステップ 6: レビュー指摘を修正する（レビュイー側）

レビューで指摘を受けたら、修正して再度プッシュする。

```bash
# 自分のブランチにいることを確認
git branch

# ファイルを修正する（VS Codeで編集）

# 修正をコミットしてプッシュ
git add team_docs/team_rules.md
git commit -m "fix: レビュー指摘を反映"
git push
```

> PRのページを見ると、新しいコミットが自動的にPRに追加されている。

### ステップ 7: Approve する（レビュアー側）

修正を確認したら、Approveする。

1. PRページで修正内容を確認
2. 「Review changes」をクリック
3. 「Approve」を選択
4. コメント欄に「LGTM!」など書いて「Submit review」

> **LGTM** = "Looks Good To Me"（いいと思います）。レビューの定番フレーズ。

### ステップ 8: マージする

Approve を受けたら、PRをマージする。

1. PRページの「Merge pull request」をクリック
2. 「Confirm merge」をクリック

### ステップ 9: mainを更新して次の人へ

マージ後、**全員が**ローカルのmainを更新する。

```bash
git checkout main
git pull
```

**確認**: `team_rules.md` にマージされた内容が反映されていることを確認する。

```bash
cat team_docs/team_rules.md
```

> 次の人は、この最新のmainからブランチを切ってステップ1に戻る。

---

## 実験

### 実験1: レビューコメントの確認

1. PRの「Conversation」タブでレビューコメントを確認する
2. 「Files changed」タブで行単位のコメントを確認する
3. 2つのタブの違いを観察する

### 実験2: 再プッシュ後のPRの変化

1. レビュー指摘を修正してプッシュした後、PRページをリロードする
2. PRに新しいコミットが追加されていることを確認する
3. 差分（Files changed）がどう変化したか確認する

### 実験3: 2番目・3番目の人のPR

1. 2番目の人がPRを出すとき、`team_rules.md` の内容を確認する
2. 1番目の人が追加したルールが含まれていることを確認する
3. `git pull` でmainを更新していたからこそ、最新の状態を元に作業できたことを確認する

---

## 実験レポート

`day12_report.md` として保存し、コミットすること。

```
実験1: レビューコメントの確認
  「Conversation」タブで見えるもの:（実験後に書く）
  「Files changed」タブで見えるもの:（実験後に書く）
  2つのタブの違い:（考察を書く）

実験2: 再プッシュ後のPRの変化
  予想:（実験前に書く — 修正してプッシュしたら、PRはどうなると思うか？）
  結果:（実験後に書く — 実際にPRページに何が表示されたか）
  わかったこと:（PRとブランチの関係について考察）

実験3: 2番目・3番目の人のPR
  予想:（実験前に書く — 2番目の人が作業を始めるとき、team_rules.md はどうなっているか？）
  結果:（実験後に書く — 実際のファイル内容）
  わかったこと:（なぜ git pull が重要なのか、自分の言葉で説明）
```

---

## 完了条件

- [ ] PRを作成し、レビューコメントを受けた
- [ ] レビュー指摘を修正して再プッシュした
- [ ] 他のメンバーのPRにレビューコメントをつけた
- [ ] Approve してマージを完了した
- [ ] 全員が `git pull` でmainを最新状態にした
- [ ] `team_rules.md` に全員のルールが追記されている
- [ ] 実験レポート（`day12_report.md`）を提出した
